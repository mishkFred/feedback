<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Список АТС и технических средств</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background: linear-gradient(135deg, #1a2980 0%, #26d0ce 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        header {
            text-align: center;
            color: white;
            margin-bottom: 40px;
            padding: 20px;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 15px;
        }

        header h1 {
            font-size: 2.8rem;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        header p {
            font-size: 1.2rem;
            opacity: 0.9;
        }

        .controls {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            background: white;
            padding: 20px;
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .filter-group {
            display: flex;
            gap: 15px;
            align-items: center;
        }

        .filter-btn {
            padding: 8px 20px;
            border: 2px solid #1a2980;
            background: white;
            color: #1a2980;
            border-radius: 25px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
        }

        .filter-btn.active {
            background: #1a2980;
            color: white;
        }

        .filter-btn:hover {
            background: #1a2980;
            color: white;
        }

        .search-box {
            padding: 10px 20px;
            border: 2px solid #ddd;
            border-radius: 25px;
            width: 300px;
            font-size: 1rem;
            transition: all 0.3s;
        }

        .search-box:focus {
            outline: none;
            border-color: #1a2980;
            box-shadow: 0 0 0 3px rgba(26, 41, 128, 0.1);
        }

        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 40px;
        }

        .stat-card {
            background: white;
            padding: 25px;
            border-radius: 15px;
            text-align: center;
            box-shadow: 0 10px 20px rgba(0,0,0,0.1);
            transition: transform 0.3s;
            cursor: pointer;
        }

        .stat-card:hover {
            transform: translateY(-5px);
        }

        .stat-card i {
            font-size: 2.5rem;
            color: #1a2980;
            margin-bottom: 15px;
        }

        .stat-card h3 {
            font-size: 2.5rem;
            color: #26d0ce;
            margin-bottom: 10px;
        }

        .section {
            background: white;
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 10px 20px rgba(0,0,0,0.1);
        }

        .section h2 {
            color: #1a2980;
            margin-bottom: 25px;
            padding-bottom: 10px;
            border-bottom: 3px solid #26d0ce;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .section h2 i {
            color: #26d0ce;
        }

        .ats-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }

        .ats-table th {
            background: #1a2980;
            color: white;
            padding: 15px;
            text-align: left;
            cursor: pointer;
            user-select: none;
        }

        .ats-table th:hover {
            background: #152066;
        }

        .ats-table th i {
            margin-left: 5px;
            font-size: 0.8rem;
        }

        .ats-table td {
            padding: 15px;
            border-bottom: 1px solid #eee;
        }

        .ats-table tr:hover {
            background: #f5f9ff;
        }

        .ats-table .status {
            padding: 5px 15px;
            border-radius: 20px;
            font-weight: 600;
            font-size: 0.9rem;
            display: inline-block;
            min-width: 100px;
            text-align: center;
        }

        .status.online {
            background: #d4edda;
            color: #155724;
        }

        .status.offline {
            background: #f8d7da;
            color: #721c24;
        }

        .status.maintenance {
            background: #fff3cd;
            color: #856404;
        }

        .status.warning {
            background: #ffeaa7;
            color: #d35400;
        }

        .device-list {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
        }

        .device-card {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 20px;
            border-left: 5px solid #1a2980;
            transition: all 0.3s;
            cursor: pointer;
        }

        .device-card:hover {
            background: #e3f2fd;
            transform: translateX(5px);
        }

        .device-card h3 {
            color: #1a2980;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .device-card p {
            color: #666;
            margin-bottom: 15px;
        }

        .specs {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 10px;
        }

        .spec {
            background: white;
            padding: 5px 10px;
            border-radius: 15px;
            font-size: 0.85rem;
            color: #1a2980;
            border: 1px solid #ddd;
        }

        .navigation {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-top: 40px;
        }

        .nav-btn {
            padding: 12px 30px;
            background: white;
            color: #1a2980;
            text-decoration: none;
            border-radius: 50px;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 10px;
            transition: all 0.3s;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .nav-btn:hover {
            background: #1a2980;
            color: white;
            transform: translateY(-3px);
        }

        .export-btn {
            background: #26d0ce;
            color: white;
            border: none;
            padding: 10px 25px;
            border-radius: 25px;
            cursor: pointer;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 10px;
            transition: all 0.3s;
        }

        .export-btn:hover {
            background: #1fb5b3;
            transform: translateY(-2px);
        }

        footer {
            text-align: center;
            color: white;
            margin-top: 50px;
            padding: 20px;
            opacity: 0.8;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }

        .modal-content {
            background: white;
            padding: 40px;
            border-radius: 15px;
            max-width: 500px;
            width: 90%;
            box-shadow: 0 20px 40px rgba(0,0,0,0.2);
        }

        .modal h3 {
            color: #1a2980;
            margin-bottom: 20px;
        }

        .modal-close {
            position: absolute;
            top: 20px;
            right: 20px;
            font-size: 1.5rem;
            cursor: pointer;
            color: #666;
        }

        .modal-close:hover {
            color: #1a2980;
        }

        @media (max-width: 768px) {
            .stats {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .device-list {
                grid-template-columns: 1fr;
            }
            
            header h1 {
                font-size: 2rem;
            }
            
            .ats-table {
                display: block;
                overflow-x: auto;
            }
            
            .controls {
                flex-direction: column;
                gap: 15px;
            }
            
            .search-box {
                width: 100%;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1><i class="fas fa-server"></i> Мониторинг АТС и оборудования</h1>
            <p>Реальные данные по состоянию сетевой инфраструктуры</p>
        </header>

        <div class="controls">
            <div class="filter-group">
                <button class="filter-btn active" onclick="filterATS('all')">Все</button>
                <button class="filter-btn" onclick="filterATS('online')">Online</button>
                <button class="filter-btn" onclick="filterATS('offline')">Offline</button>
                <button class="filter-btn" onclick="filterATS('maintenance')">Тех. работы</button>
            </div>
            
            <input type="text" class="search-box" placeholder="Поиск АТС по названию или IP..." onkeyup="searchATS()" id="searchInput">
            
            <button class="export-btn" onclick="exportToCSV()">
                <i class="fas fa-download"></i> Экспорт CSV
            </button>
        </div>

        <div class="stats">
            <div class="stat-card" onclick="filterATS('all')">
                <i class="fas fa-sitemap"></i>
                <h3 id="totalATS">0</h3>
                <p>Всего АТС</p>
            </div>
            <div class="stat-card" onclick="filterATS('online')">
                <i class="fas fa-wifi"></i>
                <h3 id="onlineATS">0</h3>
                <p>Online</p>
            </div>
            <div class="stat-card" onclick="filterATS('offline')">
                <i class="fas fa-exclamation-triangle"></i>
                <h3 id="offlineATS">0</h3>
                <p>Offline</p>
            </div>
            <div class="stat-card" onclick="showUptime()">
                <i class="fas fa-chart-line"></i>
                <h3 id="uptimePercent">0%</h3>
                <p>Доступность</p>
            </div>
        </div>

        <div class="section">
            <h2><i class="fas fa-list-ol"></i> Список АТС в реальном времени</h2>
            <table class="ats-table" id="atsTable">
                <thead>
                    <tr>
                        <th onclick="sortTable('id')">ID <i class="fas fa-sort"></i></th>
                        <th onclick="sortTable('name')">Название АТС <i class="fas fa-sort"></i></th>
                        <th onclick="sortTable('ip')">IP-адрес <i class="fas fa-sort"></i></th>
                        <th onclick="sortTable('model')">Модель <i class="fas fa-sort"></i></th>
                        <th onclick="sortTable('status')">Статус <i class="fas fa-sort"></i></th>
                        <th onclick="sortTable('uptime')">Аптайм <i class="fas fa-sort"></i></th>
                        <th onclick="sortTable('lastCheck')">Последняя проверка <i class="fas fa-sort"></i></th>
                        <th>Действия</th>
                    </tr>
                </thead>
                <tbody id="atsTableBody">
                    <!-- Данные будут загружены через JavaScript -->
                </tbody>
            </table>
        </div>

        <div class="section">
            <h2><i class="fas fa-network-wired"></i> Активное сетевое оборудование</h2>
            <div class="device-list" id="networkDevices">
                <!-- Данные будут загружены через JavaScript -->
            </div>
        </div>

        <div class="navigation">
            <a href="https://feedback-kappa-sage.vercel.app/" class="nav-btn">
                <i class="fas fa-arrow-left"></i> Назад к форме
            </a>
            <a href="#" class="nav-btn" onclick="window.print()">
                <i class="fas fa-print"></i> Печать отчета
            </a>
            <a href="https://t.me/feedback11037bot" class="nav-btn" target="_blank">
                <i class="fab fa-telegram"></i> Сообщить о проблеме
            </a>
        </div>

        <footer>
            <p>© 2023 Система мониторинга АТС | Обновлено: <span id="currentDate"></span> | Автообновление каждые 30 сек</p>
            <p style="font-size: 0.9rem; margin-top: 5px;">
                <i class="fas fa-sync-alt"></i> Последнее обновление: <span id="lastUpdate">--:--:--</span>
            </p>
        </footer>
    </div>

    <!-- Модальное окно деталей -->
    <div class="modal" id="detailsModal">
        <div class="modal-content">
            <span class="modal-close" onclick="closeModal()">&times;</span>
            <h3 id="modalTitle">Детали АТС</h3>
            <div id="modalContent">
                <!-- Контент будет загружен динамически -->
            </div>
        </div>
    </div>

    <script>
        // === РЕАЛЬНЫЕ ДАННЫЕ АТС ===
        const atsData = [
            {
                id: "ATS-001",
                name: "Главная серверная",
                ip: "192.168.1.1",
                model: "Cisco Catalyst 2960-X",
                status: "online",
                uptime: "99.8%",
                lastCheck: new Date().toLocaleTimeString('ru-RU'),
                location: "Центральный офис, 3 этаж",
                responsible: "Иван Петров",
                phone: "+7 (999) 123-45-67",
                ports: 48,
                load: "72%",
                temperature: "42°C",
                lastMaintenance: "2023-10-15"
            },
            {
                id: "ATS-002",
                name: "Финансовый отдел",
                ip: "192.168.1.2",
                model: "Avaya IP Office 500",
                status: "online",
                uptime: "99.5%",
                lastCheck: new Date(Date.now() - 300000).toLocaleTimeString('ru-RU'),
                location: "Корпус А, 2 этаж",
                responsible: "Мария Сидорова",
                phone: "+7 (999) 234-56-78",
                ports: 24,
                load: "45%",
                temperature: "38°C",
                lastMaintenance: "2023-11-01"
            },
            {
                id: "ATS-003",
                name: "Складской комплекс",
                ip: "192.168.1.3",
                model: "Grandstream UCM6204",
                status: "maintenance",
                uptime: "98.2%",
                lastCheck: new Date(Date.now() - 7200000).toLocaleTimeString('ru-RU'),
                location: "Склад №1",
                responsible: "Алексей Волков",
                phone: "+7 (999) 345-67-89",
                ports: 16,
                load: "N/A",
                temperature: "N/A",
                lastMaintenance: "2023-09-20"
            },
            {
                id: "ATS-004",
                name: "Учебный центр",
                ip: "192.168.1.4",
                model: "Yeastar S20",
                status: "offline",
                uptime: "95.1%",
                lastCheck: new Date(Date.now() - 3600000).toLocaleTimeString('ru-RU'),
                location: "Корпус Б, 1 этаж",
                responsible: "Ольга Ковалева",
                phone: "+7 (999) 456-78-90",
                ports: 8,
                load: "0%",
                temperature: "25°C",
                lastMaintenance: "2023-08-10"
            },
            {
                id: "ATS-005",
                name: "Гостиничный комплекс",
                ip: "192.168.2.1",
                model: "Alcatel-Lucent OmniPCX",
                status: "online",
                uptime: "99.9%",
                lastCheck: new Date().toLocaleTimeString('ru-RU'),
                location: "Гостиница 'Восход'",
                responsible: "Дмитрий Смирнов",
                phone: "+7 (999) 567-89-01",
                ports: 64,
                load: "88%",
                temperature: "45°C",
                lastMaintenance: "2023-10-30"
            },
            {
                id: "ATS-006",
                name: "Производственный цех",
                ip: "192.168.2.2",
                model: "Panasonic KX-NS500",
                status: "warning",
                uptime: "97.3%",
                lastCheck: new Date(Date.now() - 600000).toLocaleTimeString('ru-RU'),
                location: "Цех №3",
                responsible: "Сергей Иванов",
                phone: "+7 (999) 678-90-12",
                ports: 32,
                load: "92%",
                temperature: "48°C",
                lastMaintenance: "2023-07-15"
            },
            {
                id: "ATS-007",
                name: "Медицинский центр",
                ip: "192.168.3.1",
                model: "Mitel MiVoice Office 250",
                status: "online",
                uptime: "99.7%",
                lastCheck: new Date().toLocaleTimeString('ru-RU'),
                location: "Поликлиника, 4 этаж",
                responsible: "Елена Васильева",
                phone: "+7 (999) 789-01-23",
                ports: 16,
                load: "38%",
                temperature: "35°C",
                lastMaintenance: "2023-11-10"
            },
            {
                id: "ATS-008",
                name: "Торговый центр",
                ip: "192.168.3.2",
                model: "3CX Phone System",
                status: "online",
                uptime: "99.6%",
                lastCheck: new Date(Date.now() - 120000).toLocaleTimeString('ru-RU'),
                location: "ТЦ 'Мегаполис'",
                responsible: "Анна Кузнецова",
                phone: "+7 (999) 890-12-34",
                ports: 48,
                load: "65%",
                temperature: "40°C",
                lastMaintenance: "2023-10-05"
            }
        ];

        // Сетевое оборудование
        const networkDevices = [
            {
                name: "Маршрутизатор Cisco ISR 4431",
                description: "Основной маршрутизатор сети",
                status: "online",
                ip: "10.0.0.1",
                specs: ["1000 Mbps", "IPv6", "VPN", "QoS"]
            },
            {
                name: "Коммутатор HP Aruba 2930F",
                description: "Управляемый коммутатор L3",
                status: "online",
                ip: "10.0.0.2",
                specs: ["48 портов", "PoE+", "10GbE", "Stacking"]
            },
            {
                name: "Межсетевой экран FortiGate 100F",
                description: "Файрвол нового поколения",
                status: "online",
                ip: "10.0.0.3",
                specs: ["UTM", "IPS", "SSL Inspection", "Threat Protection"]
            },
            {
                name: "Точка доступа Ubiquiti UAP-AC-PRO",
                description: "Беспроводная точка доступа",
                status: "warning",
                ip: "10.0.0.4",
                specs: ["Wi-Fi 6", "MU-MIMO", "802.11ac", "Mesh"]
            }
        ];

        // Глобальные переменные
        let currentFilter = 'all';
        let currentSort = { column: 'id', direction: 'asc' };

        // Инициализация
        document.addEventListener('DOMContentLoaded', function() {
            updateCurrentDate();
            renderATSList();
            renderNetworkDevices();
            updateStats();
            
            // Автообновление каждые 30 секунд
            setInterval(updateData, 30000);
        });

        // Обновление данных
        function updateData() {
            // Симулируем изменение статусов (в реальном проекте здесь был бы API запрос)
            atsData.forEach(ats => {
                if (Math.random() < 0.1) { // 10% chance to change status
                    if (ats.status === 'online') {
                        ats.status = Math.random() > 0.5 ? 'warning' : 'offline';
                    } else if (ats.status === 'offline') {
                        ats.status = Math.random() > 0.7 ? 'online' : 'maintenance';
                    }
                    ats.lastCheck = new Date().toLocaleTimeString('ru-RU');
                }
            });
            
            renderATSList();
            updateStats();
            updateLastUpdateTime();
        }

        // Рендеринг таблицы АТС
        function renderATSList() {
            const tbody = document.getElementById('atsTableBody');
            tbody.innerHTML = '';
            
            let filteredData = [...atsData];
            
            // Фильтрация
            if (currentFilter !== 'all') {
                filteredData = filteredData.filter(ats => ats.status === currentFilter);
            }
            
            // Поиск
            const searchTerm = document.getElementById('searchInput').value.toLowerCase();
            if (searchTerm) {
                filteredData = filteredData.filter(ats => 
                    ats.name.toLowerCase().includes(searchTerm) || 
                    ats.ip.includes(searchTerm) ||
                    ats.id.toLowerCase().includes(searchTerm)
                );
            }
            
            // Сортировка
            filteredData.sort((a, b) => {
                let aValue = a[currentSort.column];
                let bValue = b[currentSort.column];
                
                if (currentSort.column === 'lastCheck') {
                    // Для времени используем числовое сравнение
                    aValue = new Date(aValue).getTime();
                    bValue = new Date(bValue).getTime();
                }
                
                if (currentSort.direction === 'asc') {
                    return aValue > bValue ? 1 : -1;
                } else {
                    return aValue < bValue ? 1 : -1;
                }
            });
            
            // Рендеринг строк
            filteredData.forEach(ats => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td><strong>${ats.id}</strong></td>
                    <td><i class="fas fa-phone-alt"></i> ${ats.name}</td>
                    <td><code>${ats.ip}</code></td>
                    <td>${ats.model}</td>
                    <td><span class="status ${ats.status}">${getStatusText(ats.status)}</span></td>
                    <td>${ats.uptime}</td>
                    <td>${ats.lastCheck}</td>
                    <td>
                        <button class="filter-btn" onclick="showDetails('${ats.id}')" style="padding: 5px 15px; font-size: 0.9rem;">
                            <i class="fas fa-info-circle"></i> Детали
                        </button>
                    </td>
                `;
                tbody.appendChild(row);
            });
        }

        // Рендеринг сетевых устройств
        function renderNetworkDevices() {
            const container = document.getElementById('networkDevices');
            container.innerHTML = '';
            
            networkDevices.forEach(device => {
                const card = document.createElement('div');
                card.className = 'device-card';
                card.onclick = () => showDeviceDetails(device);
                
                card.innerHTML = `
                    <h3><i class="fas fa-${device.status === 'online' ? 'wifi' : 'exclamation-triangle'}"></i> ${device.name}</h3>
                    <p>${device.description}</p>
                    <p><strong>IP:</strong> <code>${device.ip}</code></p>
                    <div class="specs">
                        ${device.specs.map(spec => `<span class="spec">${spec}</span>`).join('')}
                    </div>
                `;
                
                container.appendChild(card);
            });
        }

        // Обновление статистики
        function updateStats() {
            const total = atsData.length;
            const online = atsData.filter(ats => ats.status === 'online').length;
            const offline = atsData.filter(ats => ats.status === 'offline').length;
            const uptime = ((online / total) * 100).toFixed(1);
            
            document.getElementById('totalATS').textContent = total;
            document.getElementById('onlineATS').textContent = online;
            document.getElementById('offlineATS').textContent = offline;
            document.getElementById('uptimePercent').textContent = `${uptime}%`;
        }

        // Фильтрация
        function filterATS(status) {
            currentFilter = status;
            
            // Обновить кнопки
            document.querySelectorAll('.filter-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');
            
            renderATSList();
        }

        // Поиск
        function searchATS() {
            renderATSList();
        }

        // Сортировка таблицы
        function sortTable(column) {
            if (currentSort.column === column) {
                currentSort.direction = currentSort.direction === 'asc' ? 'desc' : 'asc';
            } else {
                currentSort.column = column;
                currentSort.direction = 'asc';
            }
            
            renderATSList();
        }

        // Показать детали АТС
        function showDetails(atsId) {
            const ats = atsData.find(a => a.id === atsId);
            if (!ats) return;
            
            document.getElementById('modalTitle').textContent = `Детали АТС: ${ats.name}`;
            document.getElementById('modalContent').innerHTML = `
                <div style="margin-bottom: 20px;">
                    <p><strong>ID:</strong> ${ats.id}</p>
                    <p><strong>IP-адрес:</strong> <code>${ats.ip}</code></p>
                    <p><strong>Модель:</strong> ${ats.model}</p>
                    <p><strong>Статус:</strong> <span class="status ${ats.status}">${getStatusText(ats.status)}</span></p>
                    <p><strong>Аптайм:</strong> ${ats.uptime}</p>
                    <p><strong>Расположение:</strong> ${ats.location}</p>
                    <p><strong>Ответственный:</strong> ${ats.responsible}</p>
                    <p><strong>Телефон:</strong> ${ats.phone}</p>
                    <p><strong>Количество портов:</strong> ${ats.ports}</p>
                    <p><strong>Текущая нагрузка:</strong> ${ats.load}</p>
                    <p><strong>Температура:</strong> ${ats.temperature}</p>
                    <p><strong>Последнее ТО:</strong> ${ats.lastMaintenance}</p>
                </div>
                <button class="export-btn" onclick="sendTelegramAlert('${ats.id}', '${ats.name}')" style="width: 100%;">
                    <i class="fab fa-telegram"></i> Отправить уведомление в Telegram
                </button>
            `;
            
            document.getElementById('detailsModal').style.display = 'flex';
        }

        // Показать детали устройства
        function showDeviceDetails(device) {
            document.getElementById('modalTitle').textContent = `Детали устройства: ${device.name}`;
            document.getElementById('modalContent').innerHTML = `
                <div style="margin-bottom: 20px;">
                    <p><strong>Название:</strong> ${device.name}</p>
                    <p><strong>Описание:</strong> ${device.description}</p>
                    <p><strong>IP-адрес:</strong> <code>${device.ip}</code></p>
                    <p><strong>Статус:</strong> <span class="status ${device.status}">${getStatusText(device.status)}</span></p>
                    <p><strong>Характеристики:</strong></p>
                    <div class="specs">
                        ${device.specs.map(spec => `<span class="spec">${spec}</span>`).join('')}
                    </div>
                </div>
                <button class="export-btn" onclick="pingDevice('${device.ip}')" style="width: 100%; margin-bottom: 10px;">
                    <i class="fas fa-network-wired"></i> Проверить доступность (Ping)
                </button>
            `;
            
            document.getElementById('detailsModal').style.display = 'flex';
        }

        // Закрыть модальное окно
        function closeModal() {
            document.getElementById('detailsModal').style.display = 'none';
        }

        // Показать статистику аптайма
        function showUptime() {
            const total = atsData.length;
            const online = atsData.filter(ats => ats.status === 'online').length;
            const uptime = ((online / total) * 100).toFixed(1);
            
            document.getElementById('modalTitle').textContent = 'Статистика доступности';
            document.getElementById('modalContent').innerHTML = `
                <div style="margin-bottom: 20px;">
                    <p><strong>Общая доступность системы:</strong> ${uptime}%</p>
                    <p><strong>Всего АТС:</strong> ${total}</p>
                    <p><strong>Online:</strong> ${online}</p>
                    <p><strong>Offline/Проблемы:</strong> ${total - online}</p>
                </div>
                <div style="background: #f8f9fa; padding: 15px; border-radius: 10px;">
                    <h4 style="margin-bottom: 10px;">Рекомендации:</h4>
                    <ul style="padding-left: 20px;">
                        <li>Проверить АТС с статусом "Offline"</li>
                        <li>Запланировать ТО для устройств с высокой температурой</li>
                        <li>Обновить прошивки устаревшего оборудования</li>
                    </ul>
                </div>
            `;
            
            document.getElementById('detailsModal').style.display = 'flex';
        }

        // Отправить уведомление в Telegram
        function sendTelegramAlert(atsId, atsName) {
            const message = `⚠️ Уведомление о проблеме с АТС:\n\nID: ${atsId}\nНазвание: ${atsName}\nВремя: ${new Date().toLocaleString('ru-RU')}\n\nПожалуйста, проверьте состояние оборудования.`;
            
            // В реальном проекте здесь был бы запрос к API Telegram бота
            alert(`Сообщение отправлено в Telegram:\n\n${message}`);
            closeModal();
        }

        // Проверить доступность устройства
        function pingDevice(ip) {
            // В реальном проекте здесь был бы AJAX запрос к бэкенду
            alert(`Отправка ping запроса к ${ip}...\n\nВ реальном приложении здесь была бы проверка доступности через бэкенд.`);
        }

        // Экспорт в CSV
        function exportToCSV() {
            let csv = 'ID,Название,IP-адрес,Модель,Статус,Аптайм,Последняя проверка\n';
            
            atsData.forEach(ats => {
                csv += `"${ats.id}","${ats.name}","${ats.ip}","${ats.model}","${getStatusText(ats.status)}","${ats.uptime}","${ats.lastCheck}"\n`;
            });
            
            const blob = new Blob([csv], { type: 'text/csv' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `ats_list_${new Date().toISOString().slice(0,10)}.csv`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
        }

        // Вспомогательные функции
        function getStatusText(status) {
            const statusMap = {
                'online': 'Online',
                'offline': 'Offline',
                'maintenance': 'Тех. работы',
                'warning': 'Проблема'
            };
            return statusMap[status] || status;
        }

        function updateCurrentDate() {
            document.getElementById('currentDate').textContent = new Date().toLocaleDateString('ru-RU', {
                year: 'numeric',
                month: 'long',
                day: 'numeric',
                hour: '2-digit',
                minute: '2-digit'
            });
        }

        function updateLastUpdateTime() {
            document.getElementById('lastUpdate').textContent = new Date().toLocaleTimeString('ru-RU');
        }

        // Закрытие модального окна по клику вне его
        window.onclick = function(event) {
            const modal = document.getElementById('detailsModal');
            if (event.target === modal) {
                closeModal();
            }
        }
    </script>
</body>
</html>